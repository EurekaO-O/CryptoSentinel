### 🟢 升级版 Phase 2：定义全量数据模型 (Data Model)

*逻辑变复杂了，首先数据结构得能装下这么多指标。*

> **提示词 2.1 (Data Structures)：**
>
> 现在的需求升级了。我们需要支持更复杂的“多因子策略”。请更新 `internal/model` (或 `pkg/model`) 下的数据结构定义。
>
> **你需要定义一个名为 `MarketIndicators` 的聚合结构体，包含以下字段：**
>
> 1. `CurrentPriceBTC` (float64)
> 2. `CurrentPriceETH` (float64)
> 3. `AHR999` (float64) - 核心囤币指标
> 4. `MVRV_ZScore` (float64) - 市场冷热指标
> 5. `MaMultiplierState` (enum/int) - 两年MA乘数状态 (0:正常, 1:跌破绿线/熊市底, 2:突破红线/疯牛顶)
> 6. `PiCycleCross` (bool) - Pi周期是否死叉 (顶部信号)
> 7. `EthRegressionState` (string) - 以太坊回归带位置 ("lower", "middle", "upper")
> 8. `AccountLeverage` (float64) - 当前账户有效杠杆
>
> 请同时更新 `Collector` 接口的定义，使其返回这个聚合结构体。 **注意：** 对于 `PiCycle` 和 `MaMultiplier` 这种复杂指标，如果 API 难以直接获取，请在代码中预留字段，暂时通过 Mock 数据或简单的价格计算（如 CurrentPrice < 0.5 * MA(730)）来填充，优先保证数据结构完整。

------

### 🔴 升级版 Phase 3：实现“作战检查单”逻辑 (The Strategy Engine)

*这是最关键的一步。直接把你整理的 Markdown 表格逻辑“喂”给代码。*

> **提示词 3.1 (Strategy Implementation)：**
>
> 接下来是核心重头戏。请在 `internal/strategy` 包中重写 `Evaluate` 函数。 我会将详细的业务逻辑发给你，请你严格按照**“风控 -> 信号 -> 执行”**的优先级将其转化为 Go 代码。
>
> **逻辑输入：** 上一步定义的 `MarketIndicators`。 **逻辑输出：** 一个结构体 `TradeSignal`，包含 `ActionBTC` (string), `ActionETH` (string), `AmountFactor` (float64), `WarningMsg` (string), `ReportMarkdown` (string)。
>
> **请逐步实现以下逻辑流程：**
>
> **第一步：风控熔断 (Safety First)**
>
> 1. **杠杆检查：** 如果 `AccountLeverage > 1.5`，直接返回 Action="HALT"，WarningMsg="⚠️ 杠杆过高(>1.5x)！停止买入，请补充保证金！"。
> 2. **逃顶检查：** 如果 `PiCycleCross == true` **或者** `MaMultiplierState == 2 (疯牛顶)`，直接返回 Action="SELL_ALERT"，WarningMsg="🚨 逃顶信号触发！Pi周期死叉或突破两年红线！禁止买入！"。
>
> **第二步：计算 BTC 基础策略 (Based on AHR999)** *根据 AHR999 值设定基础动作：*
>
> - `< 0.45`: Action="STRONG_BUY", AmountFactor=1.5
> - `0.45 - 1.20`: Action="DCA_BUY", AmountFactor=1.0
> - `1.20 - 5.00`: Action="HOLD", AmountFactor=0.0 (只囤U)
> - `> 5.00`: Action="SELL", AmountFactor=0.0
>
> **第三步：MVRV 辅助验证**
>
> - 如果 AHR999 指示买入，但 `MVRV_ZScore > 6.0` (极度过热)，强制将 Action 改为 "HOLD_CAUTION" (谨慎持有)，防止高位接盘。
>
> **第四步：ETH 独立策略 (Eth Regression)**
>
> - 如果 `EthRegressionState == "lower"` (低估区) 且 BTC 允许买入：ActionETH="BUY_HEAVY"
> - 如果 `EthRegressionState == "upper"` (高估区)：ActionETH="SELL_OR_SWAP_BTC"
> - 其他情况：ActionETH="FOLLOW_BTC"
>
> **第五步：生成报告**
>
> - 请在 `ReportMarkdown` 字段生成一段类似 CheckList 风格的字符串（使用 Emoji），用于后续发给 Telegram。
>
> 请编写代码，并为这段逻辑编写 3 个典型的单元测试用例（正常定投场景、高杠杆熔断场景、抄底场景）。

------

### 🔵 升级版 Phase 4：通知格式化 (Pretty Printer)

*让机器人发出来的消息像你写的那个周报一样漂亮。*

> **提示词 4.1 (Report Formatting)：**
>
> 我希望 Telegram 收到的消息格式非常清晰。请在 `internal/strategy` 或 `internal/notifier` 中实现一个 `FormatReport` 方法。
>
> **消息模板要求（必须使用 Markdown）：**
>
> Markdown
>
> ```
> 🛡️ **CryptoSentinel 周报** [日期]
> ```

> **1. 风控检查**
>
> - 杠杆率: [数值]x (✅ 安全 / ❌ 危险)
> - 逃顶信号: [Pi周期状态] / [MA状态]

> **2. 核心指标**
>
> - 📏 AHR999: [数值] -> [区间描述]
> - 🌡️ MVRV-Z: [数值]
> - 💎 ETH位置: [回归带位置]

> **3. 执行建议**
>
> - 🚀 **BTC 操作**: [加粗的建议，如 贪婪买入]
> - 💰 **倍率**: [数值]x
> - Ξ **ETH 操作**: [建议]

> *“看着资产像树苗一样慢慢长高，本身就是一件枯燥的事情。”*
>
> ```
> 请用 Go 的 `text/template` 或 `fmt.Sprintf` 实现这个模板填充。
> ```